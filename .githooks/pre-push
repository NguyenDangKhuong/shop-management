#!/bin/bash

# Add npm to PATH for Git GUI
export PATH="/usr/local/bin:/opt/homebrew/bin:$PATH"

# Add NVM paths dynamically (works with any Node version)
export NVM_DIR="$HOME/.nvm"
if [ -s "$NVM_DIR/nvm.sh" ]; then
    \. "$NVM_DIR/nvm.sh"
    # Use nvm to get current version
    if command -v nvm &> /dev/null; then
        NODE_VERSION=$(nvm current 2>/dev/null)
        if [ -n "$NODE_VERSION" ] && [ "$NODE_VERSION" != "none" ]; then
            export PATH="$NVM_DIR/versions/node/$NODE_VERSION/bin:$PATH"
        fi
    fi
fi

echo "ğŸ” Running pre-push checks..."

echo ""
echo "ğŸ“ Running linter..."
npm run lint || {
    echo "âŒ Linting failed. Please fix linting errors before pushing."
    echo "ğŸ’¡ To skip this check, use: git push --no-verify"
    exit 1
}

echo ""
echo "ğŸ§ª Running tests..."
npm test || {
    echo "âŒ Tests failed. Please fix failing tests before pushing."
    echo "ğŸ’¡ To skip this check, use: git push --no-verify"
    exit 1
}

echo ""
echo "ğŸ—ï¸  Checking build..."
npm run build || {
    echo "âŒ Build failed. Please fix build errors before pushing."
    echo "ğŸ’¡ To skip this check, use: git push --no-verify"
    exit 1
}

echo ""
echo "âœ… All checks passed! Pushing to remote..."
